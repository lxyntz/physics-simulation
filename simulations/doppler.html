<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤šæ™®å‹’æ•ˆåº” - ç‰©ç†å¯è§†åŒ–æ•™å­¦</title>
    <!-- å¼•å…¥å¤–éƒ¨åº“ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- æ ·å¼ -->
    <style>
        :root {
            --primary: #5E6AD2;
            --primary-light: #8D91E2;
            --secondary: #10B981;
            --accent: #F59E0B;
            --dark: #111827;
            --light: #F9FAFB;
            --gray: #6B7280;
            --light-gray: #E5E7EB;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            color: var(--dark);
            background-color: var(--light);
        }
        
        .btn {
            transition: transform 0.2s ease;
        }
        
        .btn:hover {
            transform: scale(1.05);
        }
        
        /* æ»‘å—è‡ªå®šä¹‰æ ·å¼ */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #e5e7eb;
            outline: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #5E6AD2;
            cursor: pointer;
        }
        
        /* Canvas å®¹å™¨ */
        #simulation-container {
            position: relative;
            background-color: #FFFFFF;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        canvas {
            display: block;
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="bg-white shadow-sm sticky top-0 z-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <a href="../index.html" class="flex items-center text-xl font-semibold text-gray-800">
                        <i class="fas fa-arrow-left mr-2 text-indigo-600"></i>
                        è¿”å›é¦–é¡µ
                    </a>
                </div>
                <div class="flex items-center">
                    <span class="text-xl font-semibold text-gray-800">
                        <i class="fas fa-volume-up mr-2 text-indigo-600"></i>
                        å¤šæ™®å‹’æ•ˆåº”
                    </span>
                </div>
            </div>
        </div>
    </nav>

    <!-- ä¸»è¦å†…å®¹ -->
    <main class="max-w-7xl mx-auto px-4 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- å·¦ä¾§æ§åˆ¶é¢æ¿ -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-xl font-semibold mb-6 text-gray-800 border-b pb-2">å®éªŒå‚æ•°æ§åˆ¶</h3>
                    
                    <div class="space-y-6">
                        <!-- åœºæ™¯é€‰æ‹© -->
                        <div>
                            <label for="scenario" class="block text-sm font-medium text-gray-700 mb-2">
                                å®éªŒåœºæ™¯
                            </label>
                            <select id="scenario" class="rounded-md border border-gray-300 w-full py-2 px-3">
                                <option value="source-moving">å£°æºè¿åŠ¨</option>
                                <option value="observer-moving">è§‚å¯Ÿè€…è¿åŠ¨</option>
                                <option value="both-moving">åŒæ–¹åŒæ—¶è¿åŠ¨</option>
                            </select>
                        </div>
                        
                        <!-- å£°é€Ÿæ§åˆ¶ -->
                        <div>
                            <label for="sound-speed" class="block text-sm font-medium text-gray-700 mb-2">
                                å£°é€Ÿ (m/s)
                                <span id="sound-speed-value" class="text-indigo-600 ml-2">340</span>
                            </label>
                            <input type="range" id="sound-speed" min="200" max="400" value="340" class="w-full">
                        </div>
                        
                        <!-- å£°æºé¢‘ç‡æ§åˆ¶ -->
                        <div>
                            <label for="source-frequency" class="block text-sm font-medium text-gray-700 mb-2">
                                å£°æºé¢‘ç‡ (Hz)
                                <span id="source-frequency-value" class="text-indigo-600 ml-2">500</span>
                            </label>
                            <input type="range" id="source-frequency" min="200" max="1000" value="500" class="w-full">
                        </div>
                        
                        <!-- å£°æºé€Ÿåº¦æ§åˆ¶ -->
                        <div>
                            <label for="source-speed" class="block text-sm font-medium text-gray-700 mb-2">
                                å£°æºé€Ÿåº¦ (m/s)
                                <span id="source-speed-value" class="text-indigo-600 ml-2">30</span>
                            </label>
                            <input type="range" id="source-speed" min="0" max="100" value="30" class="w-full">
                        </div>
                        
                        <!-- è§‚å¯Ÿè€…é€Ÿåº¦æ§åˆ¶ -->
                        <div>
                            <label for="observer-speed" class="block text-sm font-medium text-gray-700 mb-2">
                                è§‚å¯Ÿè€…é€Ÿåº¦ (m/s)
                                <span id="observer-speed-value" class="text-indigo-600 ml-2">0</span>
                            </label>
                            <input type="range" id="observer-speed" min="0" max="100" value="0" class="w-full">
                        </div>
                        
                        <!-- æ˜¾ç¤ºæ§åˆ¶ -->
                        <div class="space-y-3">
                            <div class="flex items-center">
                                <input type="checkbox" id="show-wavefronts" class="rounded text-indigo-600 h-4 w-4" checked>
                                <label for="show-wavefronts" class="ml-2 block text-sm text-gray-700">æ˜¾ç¤ºæ³¢å‰</label>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="show-formula" class="rounded text-indigo-600 h-4 w-4" checked>
                                <label for="show-formula" class="ml-2 block text-sm text-gray-700">æ˜¾ç¤ºè®¡ç®—å…¬å¼</label>
                            </div>
                        </div>
                        
                        <!-- æŒ‰é’®ç»„ -->
                        <div class="flex space-x-3 pt-4 border-t">
                            <button id="reset-btn" class="flex-1 bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition btn">
                                <i class="fas fa-redo-alt mr-2"></i>é‡ç½®
                            </button>
                            <button id="start-btn" class="flex-1 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition btn">
                                <i class="fas fa-play mr-2"></i>å¼€å§‹
                            </button>
                            <button id="pause-btn" class="flex-1 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition btn">
                                <i class="fas fa-pause mr-2"></i>æš‚åœ
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- æµ‹é‡ç»“æœé¢æ¿ -->
                <div class="bg-white rounded-xl shadow-md p-6 mt-6">
                    <h3 class="text-xl font-semibold mb-6 text-gray-800 border-b pb-2">æ•ˆåº”æµ‹é‡</h3>
                    
                    <div class="space-y-4">
                        <div>
                            <div class="text-sm text-gray-700">è§‚å¯Ÿåˆ°çš„é¢‘ç‡:</div>
                            <div id="observed-frequency" class="text-xl font-bold text-indigo-600">500 Hz</div>
                        </div>
                        
                        <div>
                            <div class="text-sm text-gray-700">é¢‘ç‡å˜åŒ–:</div>
                            <div id="frequency-shift" class="text-xl font-bold text-green-600">0 Hz</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- å³ä¾§æ¨¡æ‹ŸåŒºåŸŸ -->
            <div class="lg:col-span-2 space-y-6">
                <!-- æ¨¡æ‹Ÿç”»å¸ƒ -->
                <div id="simulation-container" class="w-full" style="min-height: 500px;">
                    <canvas id="simulation-canvas"></canvas>
                </div>
                
                <!-- å®éªŒåŸç†è¯´æ˜ -->
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-xl font-semibold mb-4 text-gray-800">å¤šæ™®å‹’æ•ˆåº”åŸç†</h3>
                    <p class="text-gray-600 mb-4">
                        å¤šæ™®å‹’æ•ˆåº”æ˜¯æ³¢æºå’Œè§‚å¯Ÿè€…ä¹‹é—´å­˜åœ¨ç›¸å¯¹è¿åŠ¨æ—¶ï¼Œè§‚å¯Ÿè€…æ¥æ”¶åˆ°çš„æ³¢é¢‘ç‡ä¸æ³¢æºå‘å‡ºçš„é¢‘ç‡ä¸åŒçš„ç°è±¡ã€‚å½“æ³¢æºå’Œè§‚å¯Ÿè€…ç›¸äº’æ¥è¿‘æ—¶ï¼Œè§‚å¯Ÿè€…æ¥æ”¶åˆ°çš„é¢‘ç‡å¢åŠ ï¼›å½“æ³¢æºå’Œè§‚å¯Ÿè€…ç›¸äº’è¿œç¦»æ—¶ï¼Œè§‚å¯Ÿè€…æ¥æ”¶åˆ°çš„é¢‘ç‡å‡å°ã€‚
                    </p>
                    <p class="text-gray-600 mb-4">
                        å¤šæ™®å‹’æ•ˆåº”å…¬å¼ï¼š
                    </p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 bg-gray-50 rounded-md p-4 my-4">
                        <div class="text-center">
                            <span class="text-lg text-gray-800 font-medium">å£°æºè¿åŠ¨æ—¶ï¼šf' = f Ã— [v / (v - vâ‚›)]</span>
                            <p class="text-sm text-gray-600 mt-1">vâ‚›ä¸ºå£°æºé€Ÿåº¦ï¼Œvä¸ºå£°é€Ÿ</p>
                        </div>
                        <div class="text-center">
                            <span class="text-lg text-gray-800 font-medium">è§‚å¯Ÿè€…è¿åŠ¨æ—¶ï¼šf' = f Ã— [(v + vâ‚’) / v]</span>
                            <p class="text-sm text-gray-600 mt-1">vâ‚’ä¸ºè§‚å¯Ÿè€…é€Ÿåº¦ï¼Œvä¸ºå£°é€Ÿ</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- é¡µè„š -->
    <footer class="bg-gray-50 border-t border-gray-200 py-6 mt-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col sm:flex-row justify-between items-center">
                <p class="text-sm text-gray-500">&copy; 2025 ç‰©ç†å¯è§†åŒ–æ•™å­¦å¹³å°. ä¿ç•™æ‰€æœ‰æƒåˆ©.</p>
                <p class="text-sm text-gray-500 mt-2 sm:mt-0">ä½œè€…ï¼š<span class="text-indigo-600 font-medium">Lisa</span></p>
            </div>
        </div>
    </footer>

    <!-- JavaScriptä»£ç  -->
    <script>
    // ç­‰å¾…DOMå®Œå…¨åŠ è½½
    document.addEventListener('DOMContentLoaded', function() {
        // è·å–DOMå…ƒç´ 
        const canvas = document.getElementById('simulation-canvas');
        const container = document.getElementById('simulation-container');
        const startBtn = document.getElementById('start-btn');
        const pauseBtn = document.getElementById('pause-btn');
        const resetBtn = document.getElementById('reset-btn');
        const scenarioSelect = document.getElementById('scenario');
        const showWavefrontsCheck = document.getElementById('show-wavefronts');
        const showFormulaCheck = document.getElementById('show-formula');
        
        // è·å–æ»‘å—å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
        const soundSpeedSlider = document.getElementById('sound-speed');
        const sourceFrequencySlider = document.getElementById('source-frequency');
        const sourceSpeedSlider = document.getElementById('source-speed');
        const observerSpeedSlider = document.getElementById('observer-speed');
        
        // æ˜¾ç¤ºæ»‘å—å€¼çš„å…ƒç´ 
        const soundSpeedValue = document.getElementById('sound-speed-value');
        const sourceFrequencyValue = document.getElementById('source-frequency-value');
        const sourceSpeedValue = document.getElementById('source-speed-value');
        const observerSpeedValue = document.getElementById('observer-speed-value');
        
        // ç»“æœæ˜¾ç¤ºå…ƒç´ 
        const observedFrequencyElement = document.getElementById('observed-frequency');
        const frequencyShiftElement = document.getElementById('frequency-shift');
        
        // æ·»åŠ æ»‘å—äº‹ä»¶
        soundSpeedSlider.addEventListener('input', function() {
            soundSpeedValue.textContent = this.value;
            updateSimulation();
        });
        
        sourceFrequencySlider.addEventListener('input', function() {
            sourceFrequencyValue.textContent = this.value;
            updateSimulation();
        });
        
        sourceSpeedSlider.addEventListener('input', function() {
            sourceSpeedValue.textContent = this.value;
            updateSimulation();
        });
        
        observerSpeedSlider.addEventListener('input', function() {
            observerSpeedValue.textContent = this.value;
            updateSimulation();
        });
        
        scenarioSelect.addEventListener('change', updateSimulation);
        showWavefrontsCheck.addEventListener('change', updateSimulation);
        showFormulaCheck.addEventListener('change', updateSimulation);
        
        // è®¾ç½®ç”»å¸ƒå°ºå¯¸
        function resizeCanvas() {
            canvas.width = container.offsetWidth;
            canvas.height = 500;
        }
        
        // åˆå§‹åŒ–
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
        
        // æ¨¡æ‹ŸçŠ¶æ€
        let isPaused = true;
        let animationFrameId = null;
        
        // æ¨¡æ‹Ÿå‚æ•°
        let soundSpeed = parseInt(soundSpeedSlider.value);
        let sourceFrequency = parseInt(sourceFrequencySlider.value);
        let sourceSpeed = parseInt(sourceSpeedSlider.value);
        let observerSpeed = parseInt(observerSpeedSlider.value);
        let showWavefronts = showWavefrontsCheck.checked;
        let showFormula = showFormulaCheck.checked;
        
        // æ¨¡æ‹Ÿå¯¹è±¡
        let sourceX = canvas.width * 0.3;
        let observerX = canvas.width * 0.7;
        const centerY = canvas.height / 2;
        let time = 0;
        
        // æ³¢å‰æ•°ç»„
        let wavefronts = [];
        const maxWavefronts = 30;
        
        // åˆå§‹åŒ–æ³¢å‰
        function initWavefronts() {
            wavefronts = [];
            for (let i = 0; i < maxWavefronts; i++) {
                wavefronts.push({
                    x: sourceX,
                    radius: 0,
                    alpha: 0
                });
            }
            
            // æ·»åŠ åˆå§‹å¯è§æ³¢å‰
            for (let i = 0; i < 5; i++) {
                wavefronts[i].radius = i * 20;
                wavefronts[i].alpha = 200 - i * 30;
            }
        }
        
        // æ›´æ–°æ³¢å‰
        function updateWavefronts() {
            let waveInterval = 0.1; // æ¯éš”0.1ç§’äº§ç”Ÿä¸€ä¸ªæ–°æ³¢å‰
            
            for (let i = 0; i < maxWavefronts; i++) {
                // æ³¢å‰ä»å£°æºå½“å‰ä½ç½®å‘å‡º
                if (i === 0 || (wavefronts[i-1].radius > soundSpeed * waveInterval * 20)) {
                    if (wavefronts[i].radius === 0) {
                        wavefronts[i].x = sourceX;
                        wavefronts[i].alpha = 255;
                    }
                }
                
                // æ³¢å‰åŠå¾„å¢åŠ 
                if (wavefronts[i].alpha > 0) {
                    wavefronts[i].radius += soundSpeed * 0.3;
                    wavefronts[i].alpha = Math.max(0, wavefronts[i].alpha - 1);
                }
            }
        }
        
        // ç»˜åˆ¶æ¨¡æ‹Ÿ
        function drawSimulation() {
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶èƒŒæ™¯
            ctx.fillStyle = '#F5F7FA';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶åœ°é¢
            ctx.fillStyle = '#DCDCDC';
            ctx.fillRect(0, centerY + 50, canvas.width, canvas.height - centerY - 50);
            
            // ç»˜åˆ¶æ³¢å‰
            if (showWavefronts) {
                for (let i = 0; i < maxWavefronts; i++) {
                    if (wavefronts[i].alpha > 0) {
                        ctx.beginPath();
                        ctx.arc(wavefronts[i].x, centerY, wavefronts[i].radius, 0, Math.PI * 2);
                        ctx.strokeStyle = `rgba(64, 87, 229, ${wavefronts[i].alpha / 255})`;
                        ctx.lineWidth = 3;
                        ctx.stroke();
                    }
                }
            }
            
            // ç»˜åˆ¶å£°æº
            ctx.fillStyle = '#F59E0B';
            ctx.beginPath();
            ctx.arc(sourceX, centerY, 15, 0, Math.PI * 2);
            ctx.fill();
            
            // å£°æºæ ‡ç­¾
            ctx.fillStyle = '#F59E0B';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(`f = ${sourceFrequency} Hz`, sourceX, centerY - 25);
            
            // ç»˜åˆ¶å£°æºå›¾æ ‡
            ctx.fillStyle = '#FFFFFF';
            ctx.font = '16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('â™«', sourceX, centerY + 5);
            
            // ç»˜åˆ¶è§‚å¯Ÿè€…
            ctx.fillStyle = '#10B981';
            ctx.beginPath();
            ctx.arc(observerX, centerY, 15, 0, Math.PI * 2);
            ctx.fill();
            
            // è§‚å¯Ÿè€…æ ‡ç­¾
            let observedFrequency = calculateObservedFrequency();
            ctx.fillStyle = '#10B981';
            ctx.font = '12px Arial';
            ctx.fillText(`f' = ${Math.round(observedFrequency)} Hz`, observerX, centerY - 25);
            
            // ç»˜åˆ¶è§‚å¯Ÿè€…å›¾æ ‡
            ctx.fillStyle = '#FFFFFF';
            ctx.font = '16px Arial';
            ctx.fillText('ğŸ‘‚', observerX, centerY + 5);
            
            // ç»˜åˆ¶å…¬å¼å’Œè¯´æ˜
            if (showFormula) {
                ctx.fillStyle = '#4B5563';
                ctx.font = '14px Arial';
                ctx.textAlign = 'left';
                
                let x = 20;
                let y = 30;
                let lineHeight = 20;
                
                ctx.fillText("å¤šæ™®å‹’æ•ˆåº”è®¡ç®—:", x, y);
                y += lineHeight;
                
                let scenario = scenarioSelect.value;
                if (scenario === 'source-moving') {
                    ctx.fillText("å£°æºå‘è§‚å¯Ÿè€…è¿åŠ¨:", x, y);
                    y += lineHeight;
                    ctx.fillText("f' = f Ã— [v / (v - vâ‚›)]", x, y);
                    y += lineHeight;
                } else if (scenario === 'observer-moving') {
                    ctx.fillText("è§‚å¯Ÿè€…å‘å£°æºè¿åŠ¨:", x, y);
                    y += lineHeight;
                    ctx.fillText("f' = f Ã— [(v + vâ‚’) / v]", x, y);
                    y += lineHeight;
                } else if (scenario === 'both-moving') {
                    ctx.fillText("å£°æºå’Œè§‚å¯Ÿè€…åŒæ—¶è¿åŠ¨:", x, y);
                    y += lineHeight;
                    ctx.fillText("f' = f Ã— [(v + vâ‚’) / (v - vâ‚›)]", x, y);
                    y += lineHeight;
                }
                
                ctx.fillText(`å£°æºé¢‘ç‡(f): ${sourceFrequency} Hz`, x, y);
                y += lineHeight;
                ctx.fillText(`å£°é€Ÿ(v): ${soundSpeed} m/s`, x, y);
                y += lineHeight;
                
                if (scenario === 'source-moving' || scenario === 'both-moving') {
                    ctx.fillText(`å£°æºé€Ÿåº¦(vâ‚›): ${sourceSpeed} m/s`, x, y);
                    y += lineHeight;
                }
                
                if (scenario === 'observer-moving' || scenario === 'both-moving') {
                    ctx.fillText(`è§‚å¯Ÿè€…é€Ÿåº¦(vâ‚’): ${observerSpeed} m/s`, x, y);
                    y += lineHeight;
                }
                
                ctx.fillText(`è§‚å¯Ÿåˆ°çš„é¢‘ç‡(f'): ${Math.round(observedFrequency)} Hz`, x, y);
            }
            
            // å¦‚æœæ˜¯æš‚åœçŠ¶æ€ï¼Œæ˜¾ç¤ºæç¤º
            if (isPaused) {
                ctx.fillStyle = '#000000';
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText("ç‚¹å‡»'å¼€å§‹'æŒ‰é’®è¿è¡Œæ¨¡æ‹Ÿ", canvas.width / 2, 50);
            }
        }
        
        // è®¡ç®—è§‚å¯Ÿåˆ°çš„é¢‘ç‡
        function calculateObservedFrequency() {
            let scenario = scenarioSelect.value;
            let observedFrequency = sourceFrequency;
            
            if (scenario === 'source-moving') {
                if (sourceSpeed >= soundSpeed) {
                    sourceSpeed = soundSpeed - 1;
                    sourceSpeedSlider.value = sourceSpeed;
                    sourceSpeedValue.textContent = sourceSpeed;
                }
                observedFrequency = sourceFrequency * (soundSpeed / (soundSpeed - sourceSpeed));
            } else if (scenario === 'observer-moving') {
                observedFrequency = sourceFrequency * ((soundSpeed + observerSpeed) / soundSpeed);
            } else if (scenario === 'both-moving') {
                if (sourceSpeed >= soundSpeed) {
                    sourceSpeed = soundSpeed - 1;
                    sourceSpeedSlider.value = sourceSpeed;
                    sourceSpeedValue.textContent = sourceSpeed;
                }
                observedFrequency = sourceFrequency * ((soundSpeed + observerSpeed) / (soundSpeed - sourceSpeed));
            }
            
            return observedFrequency;
        }
        
        // æ›´æ–°æ¨¡æ‹Ÿæ•°æ®
        function updateSimulation() {
            // æ›´æ–°å‚æ•°
            soundSpeed = parseInt(soundSpeedSlider.value);
            sourceFrequency = parseInt(sourceFrequencySlider.value);
            sourceSpeed = parseInt(sourceSpeedSlider.value);
            observerSpeed = parseInt(observerSpeedSlider.value);
            showWavefronts = showWavefrontsCheck.checked;
            showFormula = showFormulaCheck.checked;
            
            // è®¡ç®—å’Œæ˜¾ç¤ºç»“æœ
            let observedFrequency = calculateObservedFrequency();
            observedFrequencyElement.innerText = Math.round(observedFrequency) + " Hz";
            frequencyShiftElement.innerText = Math.round(observedFrequency - sourceFrequency) + " Hz";
            
            // é‡æ–°ç»˜åˆ¶
            drawSimulation();
        }
        
        // åŠ¨ç”»å¾ªç¯
        function animate() {
            if (!isPaused) {
                // æ›´æ–°æ—¶é—´
                time += 0.03;
                
                // æ›´æ–°ä½ç½®
                let scenario = scenarioSelect.value;
                if (scenario === 'source-moving' || scenario === 'both-moving') {
                    sourceX += sourceSpeed * 0.3;
                    if (sourceX > canvas.width * 0.9) {
                        sourceX = canvas.width * 0.1;
                        initWavefronts();
                    }
                }
                
                if (scenario === 'observer-moving' || scenario === 'both-moving') {
                    observerX += observerSpeed * 0.3;
                    if (observerX > canvas.width * 0.9) {
                        observerX = canvas.width * 0.1;
                    }
                }
                
                // æ›´æ–°æ³¢å‰
                updateWavefronts();
                
                // æ›´æ–°æ˜¾ç¤º
                updateSimulation();
                
                // ç»§ç»­åŠ¨ç”»
                animationFrameId = requestAnimationFrame(animate);
            }
        }
        
        // æŒ‰é’®äº‹ä»¶
        startBtn.addEventListener('click', function() {
            isPaused = false;
            this.innerHTML = '<i class="fas fa-play mr-2"></i>è¿è¡Œä¸­...';
            pauseBtn.innerHTML = '<i class="fas fa-pause mr-2"></i>æš‚åœ';
            
            // å¯åŠ¨åŠ¨ç”»
            if (!animationFrameId) {
                animate();
            }
        });
        
        pauseBtn.addEventListener('click', function() {
            isPaused = true;
            this.innerHTML = '<i class="fas fa-pause mr-2"></i>å·²æš‚åœ';
            startBtn.innerHTML = '<i class="fas fa-play mr-2"></i>å¼€å§‹';
            
            // åœæ­¢åŠ¨ç”»
            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
                animationFrameId = null;
            }
        });
        
        resetBtn.addEventListener('click', function() {
            // é‡ç½®å‚æ•°åˆ°åˆå§‹å€¼
            soundSpeedSlider.value = 340;
            soundSpeedValue.textContent = 340;
            
            sourceFrequencySlider.value = 500;
            sourceFrequencyValue.textContent = 500;
            
            sourceSpeedSlider.value = 30;
            sourceSpeedValue.textContent = 30;
            
            observerSpeedSlider.value = 0;
            observerSpeedValue.textContent = 0;
            
            scenarioSelect.value = "source-moving";
            
            // é‡ç½®çŠ¶æ€
            isPaused = true;
            time = 0;
            sourceX = canvas.width * 0.3;
            observerX = canvas.width * 0.7;
            
            // é‡ç½®UI
            startBtn.innerHTML = '<i class="fas fa-play mr-2"></i>å¼€å§‹';
            pauseBtn.innerHTML = '<i class="fas fa-pause mr-2"></i>æš‚åœ';
            
            // é‡ç½®æ³¢å‰
            initWavefronts();
            
            // æ›´æ–°æ˜¾ç¤º
            updateSimulation();
            
            // åœæ­¢åŠ¨ç”»
            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
                animationFrameId = null;
            }
        });
        
        // åˆå§‹åŒ–æ³¢å‰å¹¶ç»˜åˆ¶åˆå§‹çŠ¶æ€
        initWavefronts();
        drawSimulation();
    });
    </script>
</body>
</html> 